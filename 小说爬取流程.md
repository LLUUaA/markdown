# Flutter App小说爬取流程

1、根据用户输入的小说名自动在后面加上最新章节列表去获取百度、360等搜索引擎的搜索结果，并将其格式化展示在APP上，这个可以直接用dart发起http完成，不需要进行其他处理。

2、展现搜索结果给用户看的时候，直接通过预先启动的几个isolate针对前十条搜索结果链接进行解析，解析该链接是否能打开，解析该链接里是否包含小说章节列表，一般有大量的td、dl、li等标签，且里面每一条都包含了一条a链接，同时需要自行补全章节链接，章节链接都是有规律的，据此可以过滤掉垃圾信息和盗版者广告以及导航信息，接下来就可以判定章节内容的有效性和长度， 

3、章节内容检测通过后就可以抓取该页面结果里所有img标签链接，并异步解析该图片的长宽以及比例，一般小说封面是高>宽且一般高不超过250px，宽不超过150px，宽大约相当于高的0.5-0.8，检测通过则表示这是小说封面图片。解析完毕后将结果动态更新到之前展示给用户看的搜索结果上。 

4、基本上用户还没选择使用哪一个搜索结果的时候就能看到每一条搜索结果下面显示了这个链接里有多少个章节，封面是什么，最新章节是什么，这里面有很多花样可以玩。 

5、用户选择搜索结果后就可以直接将预先解析好的数据展示在小说信息页面/弹出层上供用户选择是否进入阅读模式。这个时候就可以提前预处理该小说的前5个章节了，识别是不是章节内容也很简单，只要找到所有盗版网站的共通点就比较好识别了。现在主流盗版网站章节内容分段不是靠br标签就是靠p标签，只要找出抓取到的页面里，哪个元素下有大量br标签或p标签就行，然后再判断该p或br标签的父元素下提取出的文本长度是否高于1000字，通过一个个条件判断后就可以肯定这是章节内容了。 

6、解析搞完后就轮到书库分类排行榜推荐什么的，这些直接抓取起点、纵横等网站的排行榜以及分类数据就行，反正搜索的时候都是通过搜索引擎抓取的。 顺带一提，这是我现在的做法，除了没有针对那些通过js调用来展示内容的网站进行处理，其他网站基本都是通杀，而且不需要依赖服务器处理，不用担心被盗版网站封IP的问题，所有操作全都是在用户手机上完成，而且由于是isolate在处理，因此flutter的ui主线程并不会出现卡顿现象，丝般顺畅。